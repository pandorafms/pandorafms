<?xml version="1.0" encoding="utf-8"?>
<chapter>
  <title>Migrating from Pandora 1.1</title>
  <sect1><title>Migrate Pandora 1.1 to Pandora 1.2 </title>
  <para>
    You need a script called pandoradb_1.1_to_1.2.sql provided in
    Pandora Console Package for 1.2 version. Migrate 1.1 to 1.2
    versions includes:
    <itemizedlist mark='bullet'>
      <listitem>
	<para>
	  Full replacement of Pandora Console PHP Code (backup your
	  original one to replace values in /include/config.php for
	  your login, password, hostname, and database parameters.
	</para>
      </listitem>
      <listitem>
	<para>
	  Full replacement of Pandora Server PERL Code (backyou your
	  original one to replace values in pandora_server.conf. The
	  new pandora_server.conf is located at /conf directory. It's
	  possible that you need to change incoming dir, or parameters
	  into daemon scripts. Please recheck Pandora Server 1.2
	  documentation before try to run it.
	</para>
      </listitem>
      <listitem>
	<para>
	  Read documentation about new features of Pandora 1.2.
	  Migration process doesnt delete any data, you don't loss any
	  agente, config, or enviroment data, but please, read
	  _carefully_ all documentation about this process before
	  trying it.
	</para>
      </listitem>
    </itemizedlist>
  </para>
  </sect1>
  <sect1><title>Migration steps </title>
  <para>
    0. You need to stop Pandora Server before any changes in
    database. Think that you dont loose any data in the process of
    migration because agent data will be stored in incoming
    directory. Move this data to the new incoming directory before
    launch the new server, and you process that data without miss
    anything.
  </para>
  <para>
    1. DUMP all tagente_datos records to a safe file, for example
    <programlisting>
      mysqldump --no-create-info -u root -p pandora \
                tagente_datos > /tmp/pandora.conv.tmp
    </programlisting>
  </para>
  <para>
    2. Run migration SQL script, for example:
    <programlisting>
      cat pandoradb_1.1_to_1.2.sql | mysql -u root -p -D pandora
    </programlisting>
    
    PLEASE NOTE THAT this script WILL DROP your data table, so please
    DONT SKIP step #1.
  </para>
  <para>
    3. Reimport data writen in first step, for example:
    <programlisting>
      cat /tmp/pandora.conv.tmp | mysql -u root -p -D pandora
    </programlisting>
  </para>
  <para>
    4. Delete temporal files, for example:
    <programlisting>
      rm -Rf /tmp/pandora.conv.tmp
    </programlisting>
  </para>
  </sect1>
  <sect1><title>Code upgrade</title>
  <para>
    Simply backup your Pandora Console and Pandora Server install and
    proceed as if Pandora 1.2 was a new installation. Use your
    configuration values your the new configuration files in Pandora
    and Server components. Database migration is the "heavy" task, and
    need to be made before using new code.
  </para>
  </sect1>
  <sect1><title>Final steps</title>
  <para>
    Start your new Pandora components. Enter the WEB console and check
    that a new "Network Server" has been created. Please, edit each
    agent you have and assign this new server for each agent. This
    process could be automated using SQL, and you only need to do
    once. This only needs to be if you want to use Network Servers.
  </para>
  </sect1>
</chapter>
